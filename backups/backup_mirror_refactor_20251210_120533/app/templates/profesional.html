<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Profesional - AsesoriaIMSS.io</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-bold text-blue-600">AsesoriaIMSS.io</a>
            <div class="flex space-x-4">
                <a href="/" class="text-gray-700 hover:text-blue-600">Inicio</a>
                <a href="/" class="text-gray-700 hover:text-blue-600">Buscar</a>
            </div>
        </nav>
    </header>

    <!-- Professional Profile -->
    <div class="container mx-auto px-4 py-12">
        <div id="loadingContainer" class="flex justify-center py-12">
            <div class="spinner"></div>
        </div>

        <div id="profileContainer" class="hidden">
            <!-- Profile Header -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <div class="flex items-start space-x-6">
                    <img id="profileImage" src="" alt="" class="w-32 h-32 rounded-full object-cover">
                    <div class="flex-1">
                        <h1 id="professionalName" class="text-4xl font-bold text-gray-800 mb-2"></h1>
                        <p id="specialty" class="text-xl text-blue-600 font-semibold mb-2"></p>
                        <p id="city" class="text-gray-600 mb-4"></p>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <span class="text-yellow-500 text-2xl">â˜…</span>
                                <span id="rating" class="ml-2 text-2xl font-bold"></span>
                                <span id="totalReviews" class="ml-2 text-gray-500"></span>
                            </div>
                            <button onclick="openChatbot(professionalId)"
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
                                Iniciar Chat
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold mb-2">Acerca de</h3>
                    <p id="bio" class="text-gray-700"></p>
                </div>
            </div>

            <!-- Services -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold mb-6">Servicios</h3>
                <div id="servicesContainer" class="grid md:grid-cols-2 gap-6"></div>
            </div>

            <!-- Experience -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold mb-6">Experiencia Profesional</h3>
                <div id="experienceContainer" class="space-y-6"></div>
            </div>

            <!-- Certifications -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold mb-6">Certificaciones</h3>
                <div id="certificationsContainer" class="grid md:grid-cols-2 gap-6"></div>
            </div>

            <!-- Comments -->
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h3 class="text-2xl font-bold mb-6">Comentarios y ReseÃ±as</h3>
                <div id="commentsContainer" class="space-y-6"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 AsesoriaIMSS.io - Todos los derechos reservados</p>
        </div>
    </footer>

    <!-- Chatbot Widget (floating) -->
    <div id="chatbotWidget" class="hidden fixed bottom-4 right-4 w-96 bg-white rounded-lg shadow-2xl z-50">
        <div class="bg-blue-600 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
            <h4 class="font-semibold">Chat con Profesional</h4>
            <button onclick="closeChatbot()" class="text-white hover:text-gray-200">âœ•</button>
        </div>
        <div id="chatbotMessages" class="h-96 overflow-y-auto p-4 bg-gray-50"></div>
        <div class="p-4 border-t">
            <div class="flex space-x-2">
                <input type="text" id="chatbotInput" placeholder="Escribe tu mensaje..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"
                    onkeypress="if(event.key==='Enter') sendChatbotMessage()">
                <button onclick="sendChatbotMessage()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    Enviar
                </button>
                <button onclick="startVoiceRecognition()" id="micBtn"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" title="Hablar">
                    ðŸŽ¤
                </button>
                <button onclick="toggleContinuousMode()" id="continuousBtn"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                    title="Modo ConversaciÃ³n Continua">
                    â™’
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components.js') }}"></script>
    <script>
        // Get professional ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const professionalId = urlParams.get('id');

        document.addEventListener('DOMContentLoaded', async () => {
            if (!professionalId) {
                window.location.href = '/';
                return;
            }

            await loadProfessionalProfile();
        });

        async function loadProfessionalProfile() {
            const result = await getProfessional(professionalId);

            if (result.success) {
                displayProfile(result.data);
                await loadServices();
                await loadExperience();
                await loadCertifications();
                await loadComments();
            } else {
                showToast('Error al cargar perfil', 'error');
            }
        }

        function displayProfile(prof) {
            document.getElementById('profileImage').src = prof.profile_image || '/static/img/default-avatar.png';
            document.getElementById('professionalName').textContent = prof.full_name;
            document.getElementById('specialty').textContent = prof.specialty;
            document.getElementById('city').textContent = prof.city;
            document.getElementById('rating').textContent = prof.rating?.toFixed(1) || '0.0';
            document.getElementById('totalReviews').textContent = `(${prof.total_reviews || 0} reseÃ±as)`;
            document.getElementById('bio').textContent = prof.bio || 'Sin descripciÃ³n';

            document.getElementById('loadingContainer').classList.add('hidden');
            document.getElementById('profileContainer').classList.remove('hidden');
        }

        async function loadServices() {
            const result = await getProfessionalServices(professionalId);
            const container = document.getElementById('servicesContainer');

            if (result.success && result.data.services) {
                container.innerHTML = result.data.services.map(service => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-semibold text-lg mb-2">${service.name}</h4>
                        <p class="text-gray-600 text-sm mb-3">${service.description || ''}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-600 font-bold">${formatCurrency(service.price)}</span>
                            <span class="text-gray-500 text-sm">${service.duration_minutes} min</span>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No hay servicios disponibles</p>';
            }
        }

        async function loadExperience() {
            const result = await getProfessionalExperience(professionalId);
            const container = document.getElementById('experienceContainer');

            if (result.success && result.data.experience) {
                container.innerHTML = result.data.experience.map(exp => `
                    <div class="border-l-4 border-blue-600 pl-4">
                        <h4 class="font-semibold text-lg">${exp.position}</h4>
                        <p class="text-blue-600">${exp.company}</p>
                        <p class="text-gray-500 text-sm">${exp.start_date} - ${exp.end_date || 'Presente'}</p>
                        <p class="text-gray-700 mt-2">${exp.description || ''}</p>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No hay experiencia registrada</p>';
            }
        }

        async function loadCertifications() {
            const result = await getProfessionalCertifications(professionalId);
            const container = document.getElementById('certificationsContainer');

            if (result.success && result.data.certifications) {
                container.innerHTML = result.data.certifications.map(cert => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-semibold">${cert.name}</h4>
                        <p class="text-gray-600 text-sm">${cert.issuer}</p>
                        <p class="text-gray-500 text-sm">${cert.issue_date}</p>
                        ${cert.credential_url ? `<a href="${cert.credential_url}" target="_blank" class="text-blue-600 text-sm hover:underline">Ver credencial</a>` : ''}
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No hay certificaciones registradas</p>';
            }
        }

        async function loadComments() {
            const result = await getProfessionalComments(professionalId);
            const container = document.getElementById('commentsContainer');

            if (result.success && result.data.comments) {
                container.innerHTML = result.data.comments.map(comment => createCommentCard(comment)).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No hay reseÃ±as aÃºn</p>';
            }
        }
    </script>
</body>

</html>